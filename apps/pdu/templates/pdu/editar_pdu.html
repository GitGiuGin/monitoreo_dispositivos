{% load static %}
{% for pdu in pdus %}
<!-- Modal individual para cada DISPOSITIVO -->
<div class="modal fade" id="modalEditar{{ pdu.id }}" tabindex="-1" aria-labelledby="modalEditarLabel{{ pdu.id }}"
    aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <form method="post" action="{% url 'editar_pdu' pdu.id %}">
                {% csrf_token %}
                <div class="modal-header d-flex justify-content-center position-relative">
                    <h5 class="modal-title text-center w-100" id="modalEditarLabel{{ pdu.id }}">
                        Editar {{ pdu.modelo.marca.dispositivo }}
                    </h5>
                    <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body">
                    <!-- Sección: Ubicación -->
                    <h5 class="border-bottom pb-2 mb-3">Ubicación</h5>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Ubicación</label>
                            <input type="text" name="ubicacion" class="form-control" value="{{ pdu.ubicacion.nombre }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Tipo</label>
                            <select name="tipo" class="form-select" required>
                            {% for tipo in tipos %}
                                <option value="{{ tipo.valor }}" {% if tipo.valor == pdu.ubicacion.tipo %}selected{% endif %}>
                                {{ tipo.nombre }}
                                </option>
                            {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Ciudad</label>
                            <select name="ciudad" class="form-select" required>
                            {% for ciudad in ciudades %}
                                <option value="{{ ciudad.id }}" {% if ciudad.id == pdu.ubicacion.ciudad.id %}selected{% endif %}>
                                {{ ciudad.nombre }}
                                </option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Sección: Dispositivo -->
                    <h5 class="border-bottom pb-2 mb-3">Dispositivo</h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Adm</label>
                            <select name="admin" class="form-select">
                                <option value="True" {% if pdu.admin %}selected{% endif %}>Sí</option>
                                <option value="False" {% if not pdu.admin %}selected{% endif %}>No</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">Modelo</label>
                            <select name="modelo" class="form-select">
                                {% if pdu.modelo %}
                                    {% for modelo in modelos %}
                                        {% if modelo.marca.dispositivo == pdu.modelo.marca.dispositivo %}
                                            <option value="{{ modelo.id }}" {% if modelo.id == pdu.modelo.id %}selected{% endif %}>
                                                {{ modelo.marca.nombre }} {{ modelo.nombre }}
                                            </option>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <!-- Si no tiene modelo asignado, mostramos todos -->
                                    {% for modelo in modelos %}
                                        <option value="{{ modelo.id }}">
                                            {{ modelo.marca.dispositivo }} {{ modelo.marca.nombre }} {{ modelo.nombre }}
                                        </option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">NFB</label>
                            <input type="text" name="nfb" class="form-control" value="{{ pdu.nfb|default_if_none:"" }}" placeholder="Sin registro">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Serie</label>
                            <input type="text" name="serie" class="form-control" value="{{ pdu.serie|default_if_none:"" }}" placeholder="Sin registro">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">IP</label>
                            <input type="text" name="ip" class="form-control" value="{{ pdu.ip|default_if_none:"" }}" placeholder="Sin registro">
                        </div>
                        {% if request.user.rol == "ADMINISTRADOR" or request.user.rol == "SUPERVISOR" %}
                        <div class="col-md-6">
                            <label class="form-label">Usuario</label>
                            <input type="text" name="usuario" class="form-control" value="{{ pdu.usuario|default_if_none:"" }}" placeholder="Sin registro">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Clave</label>
                            <input type="text" name="clave" class="form-control" value="{{ pdu.clave|default_if_none:"" }}" placeholder="Sin registro">
                        </div>
                        {% endif %}
                    </div>
                    {% if messages %}
                    <div class="mt-3 mb-3">
                        {% for message in messages %}
                            <div class="alert alert-danger py-2 px-3" role="alert">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}
<script src="{% static 'pdu/js/editar_pdu.js' %}"></script>